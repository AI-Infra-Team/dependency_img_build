{
	"nodes":[
		{"id":"c46323a0ab440a83","type":"group","x":1500,"y":-620,"width":1260,"height":1110,"label":"å…³é”®è®¾è®¡ç»†èŠ‚"},
		{"id":"5b76f639ae73e836","type":"group","x":-300,"y":-1080,"width":670,"height":1279,"label":"ä¾èµ–é…ç½®ç»“æ„è®¾è®¡"},
		{"id":"cli-interface","type":"text","text":"# ğŸ–¥ï¸ CLI æ¥å£\n\n**cli.py**\n```bash\nbuild -c config.yaml\nstatus [-c config]\nclean [--max-age]\ninit [-o output]\n```\n\n**ç‰¹æ€§**\n- æ—  -t å‚æ•°è®¾è®¡\n- å®æ—¶è¿›åº¦æ˜¾ç¤º\n- ç¼“å­˜ç»Ÿè®¡æŠ¥å‘Š","x":590,"y":-740,"width":300,"height":430,"color":"5"},
		{"id":"future-features","type":"text","text":"# ğŸš€ æœªæ¥è§„åˆ’\n\n**è¿œç¨‹ç¼“å­˜ç³»ç»Ÿ**\n- MinIO é›†æˆ\n- GHCR æ”¯æŒ\n- ç¼“å­˜è‡ªåŠ¨æå‡\n\n**æ™ºèƒ½ä¼˜åŒ–**\n- ML é¢„æµ‹é‡å»º\n- è‡ªåŠ¨é˜¶æ®µé‡æ’\n- ç¼“å­˜é¢„çƒ­æœºåˆ¶","x":1145,"y":200,"width":280,"height":580,"color":"5"},
		{"id":"core-concept","type":"text","text":"# ğŸ¯ æ ¸å¿ƒç†å¿µ\n\n## Dynamic Docker Build System\n\n**æ¥ç®¡ Docker æ„å»ºè¿‡ç¨‹**\n- åŠ¨æ€ Dockerfile ç”Ÿæˆ\n- å¤šçº§ç¼“å­˜ç³»ç»Ÿ\n- æ™ºèƒ½é‡å»ºç­–ç•¥","x":-820,"y":-1005,"width":410,"height":300,"color":"1"},
		{"id":"env-injection","type":"text","text":"# ğŸ” ç¯å¢ƒå˜é‡æ³¨å…¥\n\n**åŠ¨æ€æ³¨å…¥ç­–ç•¥**\n- åªåœ¨é‡å»ºç‚¹å‰æ’å…¥\n- ä¿æŒå‰é¢æ­¥éª¤ç¼“å­˜\n\n**ç»§æ‰¿é…ç½®**\n- inherit_proxy: ä»£ç†å˜é‡\n- inherit_locale: è¯­è¨€è®¾ç½®\n- inherit_timezone: æ—¶åŒº\n- inherit_custom_env: è‡ªå®šä¹‰","x":1525,"y":-589,"width":398,"height":432,"color":"2"},
		{"id":"implementation-gaps","type":"text","text":"# âš ï¸ å®ç°ç»†èŠ‚è¡¥å……\n\n**1. sudo æƒé™å¤„ç†**\n- sudo_prefix() å‡½æ•°\n- é root ç”¨æˆ·è‡ªåŠ¨ææƒ\n\n**2. é˜¶æ®µä¼˜åŒ–ç®—æ³•**\n- get_optimized_stage_order()\n- åŸºäºå˜æ›´é¢‘ç‡é‡æ’\n\n**3. è°ƒè¯•è¾“å‡ºæœºåˆ¶**\n- æ¯ä¸ª RUN å‰ç¼€ DEBUG\n- ç¯å¢ƒå˜é‡çŠ¶æ€è·Ÿè¸ª\n\n**4. å‘åå…¼å®¹å±‚**\n- åŒæ—¶æ”¯æŒæ–°æ—§æ ¼å¼\n- è‡ªåŠ¨æ ¼å¼æ£€æµ‹è½¬æ¢","x":1525,"y":-96,"width":398,"height":555,"color":"red"},
        {"id":"config-format","type":"text","text":"# ğŸ“„ é…ç½®æ ¼å¼\n\n```yaml\n# æ–°æ ¼å¼\nlight_setup:\n  config_files: [...]\nheavy_setup:\n  apt_packages: [...]\n  yum_packages: [...]\n  pip_packages: [...]  # ä»…æ”¯æŒæ­¤å¤„é…ç½® pip\n  script_installs: [...]\n  \n# ç¯å¢ƒç»§æ‰¿\ninherit_env: true\ninherit_proxy: true\ninherit_custom_env: [...]\n```","x":653,"y":15,"width":400,"height":410,"color":"3"},
		{"id":"rebuild-algorithm","type":"text","text":"# ğŸ”„ æ™ºèƒ½é‡å»ºç®—æ³•\n\n**æ ¸å¿ƒé€»è¾‘**\n```python\n# æ‰¾åˆ°ç¬¬ä¸€ä¸ªå˜æ›´ç‚¹\nfor i, step in enumerate(steps):\n    if step.hash != cached.hash:\n        rebuild_from = i\n        break\n        \n# ä»å˜æ›´ç‚¹å¼€å§‹å…¨éƒ¨é‡å»º\n[keep, keep, rebuild, rebuild...]\n```\n\n**ç¯å¢ƒå˜é‡æ³¨å…¥ç‚¹**\n- åœ¨ rebuild_from å‰æ’å…¥","x":1948,"y":-589,"width":398,"height":432,"color":"4"},
		{"id":"cache-system","type":"text","text":"# ğŸ’¾ å¤šçº§ç¼“å­˜æ¶æ„\n\n## æœ¬åœ°ç¼“å­˜\n- Docker é•œåƒå±‚\n- .build_cache.json\n- é˜¶æ®µå˜æ›´ç»Ÿè®¡\n\n## è¿œç¨‹ç¼“å­˜ (è§„åˆ’)\n- MinIO å¯¹è±¡å­˜å‚¨\n- GHCR å…¬å…±ç¼“å­˜\n- å›¢é˜Ÿç¼“å­˜å…±äº«","x":1948,"y":-96,"width":373,"height":555,"color":"1"},
		{"id":"apt-optimization","type":"text","text":"# ğŸ”§ APT åŒ…å®‰è£…ä¼˜åŒ–\n\n**æ¯ä¸ªåŒ…ç‹¬ç«‹æ­¥éª¤**\n```dockerfile\nRUN apt-get update && \\\n    apt-get install -y pkg1\nRUN apt-get install -y pkg2\nRUN apt-get install -y pkg3\nRUN rm -rf /var/lib/apt/lists/*\n```\n\n**ä¼˜åŠ¿**\n- åŒ…çº§åˆ«ç¼“å­˜\n- å¢é‡å®‰è£…/åˆ é™¤\n- é¿å…é‡å¤ update","x":2347,"y":-96,"width":373,"height":555,"color":"4"},
        {"id":"pm-abstraction","type":"text","text":"# ğŸ“¦ åŒ…ç®¡ç†æŠ½è±¡\n\n**æ¥å£**\n- PackageManager(name, needs_refresh, refresh_cmd, install_cmd, remove_cmd)\n\n**å®ç°**\n- AptManager / YumManager / PipManager\n\n**çº¦å®š**\n- pip ä»…æ”¯æŒ heavy_setup.pip_packages\n- ä¸æ”¯æŒ layers.pip\n\n**Refresh**\n- apt: apt-get update\n- yum: yum makecache\n- pip: æ— éœ€\n\n**Cleanup**\n- apt: purge + autoremove\n- yum: remove\n- pip: uninstall","x":2347,"y":480,"width":380,"height":520,"color":"6"},
		{"id":"cache-manager","type":"text","text":"# ğŸ—„ï¸ ç¼“å­˜ç®¡ç†å™¨\n\n**cache_manager.py**\n- CacheManager\n- å¤šçº§ç¼“å­˜åè°ƒ\n- è¿œç¨‹ç¼“å­˜æ¥å£\n- ç¼“å­˜æå‡æœºåˆ¶\n- æ¸…ç†ç­–ç•¥","x":778,"y":790,"width":250,"height":380,"color":"6"},
		{"id":"stage-dependency","type":"text","text":"# ğŸ”— ä¾èµ–ç®¡ç†\n\n**æ‹“æ‰‘æ’åºå®ç°**\n- æ£€æµ‹å¾ªç¯ä¾èµ–\n- ç”Ÿæˆæ‰§è¡Œé¡ºåº\n- åŠ¨æ€é‡æ’ä¼˜åŒ–\n\n**é˜¶æ®µç»Ÿè®¡**\n- å˜æ›´é¢‘ç‡è·Ÿè¸ª\n- ç¼“å­˜å‘½ä¸­åˆ†æ\n- ä¼˜åŒ–å»ºè®®ç”Ÿæˆ","x":2371,"y":-589,"width":349,"height":432,"color":"2"},
		{"id":"env-manager","type":"text","text":"# ğŸŒ ç¯å¢ƒç®¡ç†å™¨\n\n**env_manager.py**\n- EnvironmentManager\n- ç³»ç»Ÿå˜é‡æå–\n- ä»£ç†å˜é‡å¤„ç†\n- æ’é™¤è§„åˆ™\n- Dockerfile ENV ç”Ÿæˆ","x":740,"y":1300,"width":250,"height":380,"color":"6"},
		{"id":"cache-json","type":"text","text":"# ğŸ“¦ .build_cache.json\n\n## ç¼“å­˜æ•°æ®ç»“æ„\n\n```json\n{\n  \"builds\": [\n    {\n      \"timestamp\": \"...\",\n      \"image_tag\": \"...\",\n      \"steps\": [...]\n    }\n  ],\n  \"step_cache\": {\n    \"hash\": {\n      \"type\": \"heavy|light\",\n      \"package\": \"apt|yum|script|config\",\n      \"command\": \"...\",\n      \"last_used\": \"...\",\n      \"cache_level\": \"local|minio|ghcr\"\n    }\n  },\n  \"package_history\": {\n    \"apt\": {\n      \"package_name\": {\n        \"change_count\": 0,\n        \"last_changed\": \"...\"\n      }\n    },\n    \"script\": {\n      \"script_name\": {\n        \"change_count\": 0,\n        \"last_changed\": \"...\"\n      }\n    }\n  },\n  \"setup_hashes\": {\n    \"image:heavy\": \"hash\",\n    \"image:light\": \"hash\"\n  }\n}\n```\n\n**åŠŸèƒ½**\n- æ„å»ºå†å²è®°å½•\n- æ­¥éª¤å“ˆå¸Œç¼“å­˜ (åŒºåˆ† Heavy/Light)\n- åŒ…çº§åˆ«å˜æ›´ç»Ÿè®¡\n- ç¼“å­˜å‘½ä¸­è¿½è¸ª","x":-1600,"y":-315,"width":545,"height":1296,"color":"1"},
		{"id":"tracker-module","type":"text","text":"# ğŸ“Š Tracker æ¨¡å—\n\n**build_tracker.py**\n- BuildTracker\n- å˜æ›´æ£€æµ‹\n- ç¼“å­˜ç»Ÿè®¡\n- é‡å»ºè®¡åˆ’ç”Ÿæˆ\n- é˜¶æ®µé¢‘ç‡åˆ†æ","x":-1020,"y":1360,"width":250,"height":380,"color":"6"},
		{"id":"generator-module","type":"text","text":"# ğŸ­ Generator æ¨¡å—\n\n**dockerfile_generator.py**\n- DockerfileGenerator\n- BuildStep æŠ½è±¡\n- åŠ¨æ€å†…å®¹ç”Ÿæˆ\n- ç¯å¢ƒå˜é‡æ³¨å…¥ç‚¹\n- è°ƒè¯•è¾“å‡ºç”Ÿæˆ","x":-615,"y":1020,"width":250,"height":380,"color":"6"},
		{"id":"reuse-strategy","type":"text","text":"# ğŸ¯ å±‚å¤ç”¨ç­–ç•¥ (å·²å‡çº§)\n\n## æœ€å¤§äº¤é›†å¤ç”¨ç®—æ³• v2.0\n\n**æ ¸å¿ƒæ€æƒ³**\næ‰¾åˆ°ä¸å½“å‰ä¾èµ–å…·æœ‰æœ€å¤§å…±åŒäº¤é›†çš„å·²æ„å»ºé•œåƒ\næ”¯æŒ APT åŒ…å’Œ Script å±‚çš„æ™ºèƒ½å¤ç”¨\n\n**å±‚ç±»å‹æ ‡è¯†**\n```\napt:package_name     # APTåŒ…å±‚\nscript:script_name   # Scriptå±‚(åŸºäºåç§°)\nconfig:*            # é…ç½®å±‚(å§‹ç»ˆé‡å»º)\n```\n\n**å¤ç”¨ç¤ºä¾‹**\n```yaml\n# ç›®æ ‡: [apt:curl, apt:git, script:setup_user]\n\n# å·²æœ‰é•œåƒ A:\n# [apt:curl, apt:git, apt:vim, script:setup_user]\n\n# å¤ç”¨åˆ†æ:\näº¤é›† = {apt:curl, apt:git, script:setup_user} # 3é¡¹\nç¼ºå¤± = {} # æ— éœ€æ„å»º\né¢å¤– = {apt:vim} # 1ä¸ªå¤šä½™APTåŒ…\n\n# ç­–ç•¥: ä½¿ç”¨é•œåƒA (ä¿ç•™é¢å¤–APTåŒ…)\n# è¯„åˆ†: 3Ã—100 - 0Ã—50 - 1Ã—0.01 = 299.99\n```\n\n**å¤šä½™ä¾èµ–ç­–ç•¥**\n- APTåŒ…: ä¿ç•™(ç§»é™¤å¯èƒ½å½±å“ç¨³å®šæ€§)\n- Script: ä¿ç•™(æ— æ³•å®‰å…¨å›æ»š)\n- å‘å‡ºè­¦å‘Šä¿¡æ¯ä¾›ç”¨æˆ·å†³ç­–\n\n**ç®—æ³•ä¼˜åŠ¿**\n- æœ€å°åŒ–æ„å»ºæ—¶é—´\n- æœ€å¤§åŒ–ç¼“å­˜åˆ©ç”¨\n- Scriptå±‚åç§°å¤ç”¨\n- æ™ºèƒ½å¤„ç†å¤šä½™ä¾èµ–","x":-990,"y":65,"width":500,"height":795,"color":"1"},
		{"id":"config-separation","type":"text","text":"# ğŸ”„ é…ç½®æ¶æ„é‡æ„\n\n## Light vs Heavy åˆ†ç¦»\n\n**æŒ‰å˜æ›´é¢‘ç‡åˆ†ç¦»**\n- Heavy Setup: è€—æ—¶æ“ä½œå…ˆæ‰§è¡Œ\n- Light Setup: å¿«é€Ÿé…ç½®åæ‰§è¡Œ\n- ä¼˜åŒ–ç¼“å­˜å‘½ä¸­ç‡","x":-180,"y":-1060,"width":530,"height":290,"color":"2"},
		{"id":"light-setup","type":"text","text":"# âš¡ Light Setup\n\n**è½»é‡çº§é…ç½®æ“ä½œ**\n- SSH é…ç½®\n- ç”¨æˆ·ç¯å¢ƒå˜é‡\n- ç³»ç»Ÿé…ç½®æ–‡ä»¶\n\n**ç‰¹ç‚¹**\n- æ‰§è¡Œå¿«é€Ÿ\n- å˜æ›´è¾ƒå°‘\n- ä¾èµ– Heavy å®Œæˆ","x":60,"y":-680,"width":280,"height":365,"color":"3"},
		{"id":"build-order","type":"text","text":"# ğŸ“‹ æ„å»ºé¡ºåºç­–ç•¥\n\n```\n1. Heavy Setup (ä¼˜å…ˆ)\n   â”œâ”€â”€ APT åŒ…å®‰è£…\n   â””â”€â”€ Script å®‰è£…\n2. Light Setup (åœ¨å)\n   â””â”€â”€ é…ç½®ä¿®æ”¹\n```\n\n**ç¼“å­˜å¤±æ•ˆè§„åˆ™**\n- Heavy å˜æ›´ â†’ Light å…¨éƒ¨å¤±æ•ˆ\n- Heavy å†…éƒ¨ â†’ å¢é‡é‡å»º","x":-151,"y":-215,"width":422,"height":394,"color":"5"},
		{"id":"heavy-setup","type":"text","text":"# ğŸ—ï¸ Heavy Setup\n\n**é‡é‡çº§å®‰è£…æ“ä½œ**\n- APT åŒ…å®‰è£… (ç‹¬ç«‹ç¼“å­˜)\n- YUM åŒ…å®‰è£… (ç‹¬ç«‹ç¼“å­˜)\n- Script å®‰è£… (Rust/C++ç­‰)\n\n**ç‰¹ç‚¹**\n- æ‰§è¡Œè€—æ—¶\n- å˜æ›´é¢‘ç¹\n- éœ€è¦ç‹¬ç«‹ç¼“å­˜å±‚","x":-280,"y":-680,"width":280,"height":365,"color":"4"},
		{"id":"layered-cache","type":"text","text":"# ğŸ—ï¸ åˆ†å±‚ç¼“å­˜ç»“æ„ (v4.0)\n\n## layers_cache.json å‡çº§\n\n```json\n{\n  \"layers\": {\n    \"apt-curl-84d3a2e3\": {\n      \"name\": \"curl\",\n      \"type\": \"apt\",\n      \"content\": \"curl\",\n      \"image\": \"ubuntu22-dev:layer-apt-curl-84d3a2e3\"\n    },\n    \"script-create_user-9ca2dfe6\": {\n      \"name\": \"create_user\",\n      \"type\": \"script\",\n      \"content\": \"useradd -m...\",\n      \"image\": \"ubuntu22-dev:layer-script-create_user-9ca2dfe6\"\n    }\n  },\n  \"image_sets\": {\n    \"ubuntu22-dev:latest\": {\n      \"packages\": [\n        \"script:apt_update\",\n        \"apt:openssh-server\",\n        \"apt:sudo\",\n        \"script:create_user\",\n        \"script:install_rust\"\n      ],\n      \"package_count\": 21,\n      \"script_count\": 4,\n      \"total_count\": 27\n    }\n  }\n}\n```\n\n**æ–°ç‰¹æ€§**\n- ç»Ÿä¸€çš„å±‚æ ‡è¯†ç¬¦æ ¼å¼\n- Scriptå±‚æŒ‰åç§°ç¼“å­˜\n- åˆ†åˆ«ç»Ÿè®¡åŒ…/è„šæœ¬æ•°é‡\n- æ”¯æŒé›†åˆè¿ç®—ä¼˜åŒ–","x":-320,"y":240,"width":430,"height":680,"color":"1"},
		{"id":"parser-module","type":"text","text":"# ğŸ“ Parser æ¨¡å—\n\n**parser.py**\n- DeclarationParser\n- è§£æ YAML/JSON\n- æ–°æ—§æ ¼å¼å…¼å®¹\n- ä¾èµ–éªŒè¯\n- é˜¶æ®µæ’åºç®—æ³•","x":403,"y":1020,"width":250,"height":380,"color":"6"},
		{"id":"reuse-module","type":"text","text":"# â™»ï¸ Reuse æ¨¡å— (å·²å‡çº§)\n\n**reuse.py**\n- LayerReuseManager\n- æœ€å¤§äº¤é›†ç®—æ³• v2.0\n- APTåŒ…+Scriptå±‚å¤ç”¨\n- é•œåƒå­˜åœ¨æ€§æ£€æŸ¥\n- æœ€ä¼˜åŸºç¡€é€‰æ‹©\n- å¤šä½™ä¾èµ–å¤„ç†ç­–ç•¥\n- æ„å»ºé›†åˆè®¡ç®—\n- æ™ºèƒ½ç¼“å­˜è¯„åˆ†\n\n**æ–°ç‰¹æ€§**\n- Scriptå±‚åç§°åŒ¹é…\n- é¢å¤–ä¾èµ–è­¦å‘Š\n- è¯¦ç»†è°ƒè¯•è¾“å‡º\n- åˆ†åˆ«ç»Ÿè®¡åŒ…/è„šæœ¬æ•°é‡","x":-315,"y":1020,"width":250,"height":530,"color":"6"},
		{"id":"orchestrator-module","type":"text","text":"# ğŸ­ Orchestrator æ¨¡å—\n\n**build_orchestrator.py**\n- BuildOrchestrator\n- æµç¨‹åè°ƒ\n- Docker æ‰§è¡Œ\n- å®æ—¶è¾“å‡º\n- è¿›åº¦æ˜¾ç¤º","x":-65,"y":1720,"width":250,"height":380,"color":"6"}
	],
	"edges":[
		{"id":"edge1","fromNode":"core-concept","fromSide":"right","toNode":"config-separation","toSide":"left"},
		{"id":"edge2","fromNode":"config-separation","fromSide":"bottom","toNode":"heavy-setup","toSide":"top"},
		{"id":"edge3","fromNode":"config-separation","fromSide":"bottom","toNode":"light-setup","toSide":"top"},
		{"id":"edge4","fromNode":"heavy-setup","fromSide":"bottom","toNode":"build-order","toSide":"top"},
		{"id":"edge5","fromNode":"light-setup","fromSide":"bottom","toNode":"build-order","toSide":"top"},
		{"id":"edge6","fromNode":"build-order","fromSide":"right","toNode":"c46323a0ab440a83","toSide":"left","label":"details"},
		{"id":"edge8","fromNode":"cli-interface","fromSide":"bottom","toNode":"config-format","toSide":"top"},
		{"id":"edge9","fromNode":"orchestrator-module","fromSide":"top","toNode":"cli-interface","toSide":"bottom","color":"1","label":"invokes"},
		{"id":"edge10","fromNode":"parser-module","fromSide":"left","toNode":"generator-module","toSide":"right","label":"data flow"},
		{"id":"edge11","fromNode":"generator-module","fromSide":"left","toNode":"tracker-module","toSide":"right","label":"data flow"},
		{"id":"edge12","fromNode":"tracker-module","fromSide":"right","toNode":"orchestrator-module","toSide":"left","label":"data flow"},
		{"id":"edge13","fromNode":"orchestrator-module","fromSide":"right","toNode":"env-manager","toSide":"left","label":"uses"},
		{"id":"edge15","fromNode":"cache-json","fromSide":"bottom","toNode":"tracker-module","toSide":"top","label":"reads/writes"},
		{"id":"edge7","fromNode":"config-separation","fromSide":"right","toNode":"cli-interface","toSide":"left"},
		{"id":"edge16","fromNode":"config-format","fromSide":"bottom","toNode":"parser-module","toSide":"top","label":"parses"},
		{"id":"edge17","fromNode":"core-concept","fromSide":"bottom","toNode":"reuse-strategy","toSide":"top","label":"evolves to"},
		{"id":"edge20","fromNode":"reuse-module","fromSide":"bottom","toNode":"orchestrator-module","toSide":"top","label":"used by"},
		{"id":"edge18","fromNode":"reuse-strategy","fromSide":"right","toNode":"layered-cache","toSide":"left","label":"implements"},
		{"id":"edge19","fromNode":"layered-cache","fromSide":"bottom","toNode":"reuse-module","toSide":"top","label":"managed by"},
		{"id":"edge22","fromNode":"layered-cache","fromSide":"right","toNode":"config-format","toSide":"bottom","label":"cached layers"}
	]
}
